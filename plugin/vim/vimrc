"==========================================
" ProjectLink: https://github.com/wklken/vim-for-server
" Author:  wklken
" Version: 0.2
" Email: wklken@yeah.net
" BlogPost: http://www.wklken.me
" Donation: http://www.wklken.me/pages/donation.html
" ReadMe: README.md
" Last_modify: 2015-07-07
" Desc: simple vim config for server, without any plugins.
"==========================================

" leader
let mapleader = ','
let g:mapleader = ','

" syntax
syntax on

" history : how many lines of history VIM has to remember
set history=2000

" filetype
filetype on
" Enable filetype plugins
filetype plugin on
filetype indent on


" base
set nocompatible                " don't bother with vi compatibility
set autoread                    " reload files when changed on disk, i.e. via `git checkout`
set shortmess=atI

set magic                       " For regular expressions turn magic on
set title                       " change the terminal's title
set nobackup                    " do not keep a backup file

set novisualbell                " turn off visual bell
set noerrorbells                " don't beep
set visualbell t_vb=            " turn off error beep/flash
set t_vb=
set tm=500


" show location
set cursorcolumn
set cursorline


" movement
set scrolloff=7                 " keep 3 lines when scrolling


" show
set ruler                       " show the current row and column
set number                      " show line numbers
set nowrap
set showcmd                     " display incomplete commands
set showmode                    " display current modes
set showmatch                   " jump to matches when entering parentheses
set matchtime=2                 " tenths of a second to show the matching parenthesis


" search
set hlsearch                    " highlight searches
set incsearch                   " do incremental searching, search as you type
set ignorecase                  " ignore case when searching
set smartcase                   " no ignorecase if Uppercase char present


" tab
set expandtab                   " expand tabs to spaces
set smarttab
set shiftround

" indent
set autoindent smartindent shiftround
set shiftwidth=4
set tabstop=4
set softtabstop=4                " insert mode tab and backspace use 4 spaces

" NOT SUPPORT
" fold
set foldenable
set foldmethod=indent
set foldlevel=99
let g:FoldMethod = 0
map <leader>zz :call ToggleFold()<cr>
fun! ToggleFold()
    if g:FoldMethod == 0
        exe "normal! zM"
        let g:FoldMethod = 1
    else
        exe "normal! zR"
        let g:FoldMethod = 0
    endif
endfun

" encoding
set encoding=utf-8
set fileencodings=ucs-bom,utf-8,cp936,gb18030,big5,euc-jp,euc-kr,latin1
set termencoding=utf-8
set ffs=unix,dos,mac
set formatoptions+=m
set formatoptions+=B

" select & complete
set selection=inclusive
set selectmode=mouse,key

set completeopt=longest,menu
set wildmenu                           " show a navigable menu for tab completion"
set wildmode=longest,list,full
set wildignore=*.o,*~,*.pyc,*.class

" others
set backspace=indent,eol,start  " make that backspace key work the way it should
set whichwrap+=<,>,h,l

" if this not work ,make sure .viminfo is writable for you
if has("autocmd")
  au BufReadPost * if line("'\"") > 1 && line("'\"") <= line("$") | exe "normal! g'\"" | endif
endif

" NOT SUPPORT
" Enable basic mouse behavior such as resizing buffers.
" set mouse=a


" ============================ theme and status line ============================

" theme
set background=dark
" colorscheme desert
colorscheme solarized

" set mark column color
hi! link SignColumn   LineNr
hi! link ShowMarksHLl DiffAdd
hi! link ShowMarksHLu DiffChange

" status line
set statusline=%<%f\ %h%m%r%=%k[%{(&fenc==\"\")?&enc:&fenc}%{(&bomb?\",BOM\":\"\")}]\ %-14.(%l,%c%V%)\ %P
set laststatus=2   " Always show the status line - use 2 lines for the status bar


" ============================ specific file type ===========================

autocmd FileType python set tabstop=4 shiftwidth=4 expandtab ai
autocmd FileType ruby set tabstop=2 shiftwidth=2 softtabstop=2 expandtab ai
autocmd BufRead,BufNew *.md,*.mkd,*.markdown  set filetype=markdown.mkd

autocmd BufNewFile *.sh,*.py exec ":call AutoSetFileHead()"
function! AutoSetFileHead()
    " .sh
    if &filetype == 'sh'
        call setline(1, "\#!/bin/bash")
    endif

    " python
    if &filetype == 'python'
        call setline(1, "\#!/usr/bin/env python")
        call append(1, "\# encoding: utf-8")
    endif

    normal G
    normal o
    normal o
endfunc

autocmd FileType c,cpp,java,go,php,javascript,puppet,python,rust,twig,xml,yml,perl autocmd BufWritePre <buffer> :call <SID>StripTrailingWhitespaces()
fun! <SID>StripTrailingWhitespaces()
    let l = line(".")
    let c = col(".")
    %s/\s\+$//e
    call cursor(l, c)
endfun

" ============================ key map ============================

nnoremap k gk
nnoremap gk k
nnoremap j gj
nnoremap gj j

map <C-j> <C-W>j
map <C-k> <C-W>k
map <C-h> <C-W>h
map <C-l> <C-W>l

nnoremap <F2> :set nu! nu?<CR>
nnoremap <F3> :set list! list?<CR>
nnoremap <F4> :set wrap! wrap?<CR>
set pastetoggle=<F5>            "    when in insert mode, press <F5> to go to
                                "    paste mode, where you can paste mass data
                                "    that won't be autoindented
au InsertLeave * set nopaste
nnoremap <F6> :exec exists('syntax_on') ? 'syn off' : 'syn on'<CR>

" kj æ›¿æ¢ Esc
inoremap kj <Esc>

" Quickly close the current window
nnoremap <leader>q :q<CR>
" Quickly save the current file
nnoremap <leader>w :w<CR>

" select all
map <Leader>sa ggVG"

" remap U to <C-r> for easier redo
nnoremap U <C-r>

" Swap implementations of ` and ' jump to markers
" By default, ' jumps to the marked line, ` jumps to the marked line and
" column, so swap them
nnoremap ' `
nnoremap ` '

" switch # *
" nnoremap # *
" nnoremap * #

"Keep search pattern at the center of the screen."
nnoremap <silent> n nzz
nnoremap <silent> N Nzz
nnoremap <silent> * *zz
nnoremap <silent> # #zz
nnoremap <silent> g* g*zz

" remove highlight
noremap <silent><leader>/ :nohls<CR>

"Reselect visual block after indent/outdent.è°ƒæ•´ç¼©è¿›åè‡ªåŠ¨é€‰ä¸­ï¼Œæ–¹ä¾¿å†æ¬¡æ“ä½œ
vnoremap < <gv
vnoremap > >gv

" y$ -> Y Make Y behave like other capitals
map Y y$

"Map ; to : and save a million keystrokes
" ex mode commands made easy ç”¨äºå¿«é€Ÿè¿›å…¥å‘½ä»¤è¡Œ
nnoremap ; :

" save
cmap w!! w !sudo tee >/dev/null %

" command mode, ctrl-a to headï¼Œ ctrl-e to tail
cnoremap <C-j> <t_kd>
cnoremap <C-k> <t_ku>
cnoremap <C-a> <Home>
cnoremap <C-e> <End>

highlight CursorLine   cterm=NONE ctermbg=black ctermfg=NONE guibg=NONE guifg=NONE
highlight CursorColumn cterm=NONE ctermbg=black ctermfg=NONE guibg=NONE guifg=NONE

nmap <silent> <c-n> :NERDTreeToggle<CR>
nmap <silent> <c-m> :TlistToggle<CR>
" åœ¨å³ä¾§çª—å£ä¸­æ˜¾ç¤º
let Tlist_Use_Right_Window=1

call pathogen#infect()  
filetype plugin indent on

" èƒŒæ™¯è‰²
" hi Normal ctermbg=None ctermfg=grey
hi Normal ctermbg=None ctermfg=darkgrey
hi LineNr ctermfg=red ctermbg=None

" cscope(example)
nmap <silent> <c-y> :cs add /data/home/kalisplu/project/qd_server/cscope.out<CR>
nmap <silent> <c-y>y :cs add /data/home/kalisplu/project/qd_server/cs_spp/cscope.out<CR>
" ä½¿ç”¨çš„åœ°æ–¹
nmap <c-c>s :cs find s <C-R>=expand("<cword>")<CR><CR>
" å®šä¹‰çš„åœ°æ–¹(ç›¸å½“äº<C-]>)
nmap <c-c>g :cs find g <C-R>=expand("<cword>")<CR><CR>
" è°ƒç”¨æœ¬å‡½æ•°çš„å‡½æ•°
nmap <c-c>c :cs find c <C-R>=expand("<cword>")<CR><CR>

" ctags
nmap <silent> <c-l> :!ctags -R .<CR>


" compile rust
nmap <silent> <leader>cr :!rustc % && ./hello<CR>
" compile c++
nmap <silent> <leader>ccpp :!g++ % && ./a.out<CR>
" python
nmap <silent> <leader>cpy :!python %<CR>
" python3
nmap <silent> <leader>cpy3 :!python3 %<CR>

" sp or vsp resize
nmap <leader>- :resize +10<CR>
nmap <leader>= :resize -10<CR>
nmap <leader>, :vertical resize +10<CR>
nmap <leader>. :vertical resize -10<CR>

nmap gD gd<C-o>zz

"  æ’ä»¶å®‰è£…å¤±è´¥
"  " Vundle Config.
"  " 
"  "
"  " Vundle é…ç½®å¼€å§‹
"  set nocompatible        " required
"  filetype off            " required
"  
"  " å¯ç”¨vundleæ¥ç®¡ç†vimæ’ä»¶
"  set rtp+=~/.vim/bundle/Vundle.vim
"  call vundle#begin()
"  " call vundle#begin('~/some/path/here')
"  " å®‰è£…æ’ä»¶å†™åœ¨è¿™é‡Œä¹‹å
"  " let Vundle mannges Vundle, required
"  Plugin 'VundleVim/Vundle.vim'
"  Plugin 'Lisper.vim'
"  " And then add your plugin configs below.
"  "
"  
"  " å®‰è£…æ’ä»¶å†™åœ¨è¿™é‡Œä¹‹å‰
"  call vundle#end()       " required
"  filetype plugin on      " required
"  " :PluginList
"  " :PluginSearch
"  " :PluginUpdate
"  " :PluginInstall    -- :PluginSearch xml
"  " :PluginClean      -- æŠŠå®‰è£…æ’ä»¶å¯¹åº”è¡Œåˆ é™¤ï¼Œç„¶åæ‰§è¡Œè¿™ä¸ªå‘½ä»¤å°±å¯ä»¥åˆ é™¤æ’ä»¶
"  " Vundle é…ç½®ç»“æŸ



" other config

" vim-airline
" Read the README.md docs.
let g:airline#extensions#tabline#enabled = 0
let g:airline#extensions#tabline#left_sep = " "
let g:airline#extensions#tabline#left_alt_sep = "|"
let g:airline#extensions#tabline#formatter = 'unique_tail'
let g:airline_theme = 'simple'
let g:airline_powerline_fonts = 0


" :set fenc=utf-8
if !exists('g:airline_symbols')
    let g:airline_symbols = {}
endif

" unicode symbols
" helptags ${dir}
" help airline
let g:airline_left_sep = 'Â»'
let g:airline_left_sep = 'â–¶'
let g:airline_right_sep = 'Â«'
let g:airline_right_sep = 'â—€'
let g:airline_symbols.crypt = 'ğŸ”’'
let g:airline_symbols.linenr = 'â˜°'
let g:airline_symbols.linenr = 'âŠ'
let g:airline_symbols.linenr = 'â¤'
let g:airline_symbols.linenr = 'Â¶'
let g:airline_symbols.maxlinenr = ''
let g:airline_symbols.maxlinenr = 'ã‘'
let g:airline_symbols.branch = 'â‡'
let g:airline_symbols.paste = 'Ï'
let g:airline_symbols.paste = 'Ã'
let g:airline_symbols.paste = 'âˆ¥'
let g:airline_symbols.spell = 'ê¨'
let g:airline_symbols.notexists = 'É†'
let g:airline_symbols.whitespace = 'Î'

" slimv for clisp
let g:slimv_swank_cmd = '! tmux new-window -d -n REPL-CLISP "clisp -i ~/.vim/bundle/slimv/slime/start-swank.lisp"'
" slimv for sbcl 
let g:slimv_swank_cmd = '! tmux new-window -d -n REPL-SBCL "sbcl --load ~/.vim/bundle/slimv/slime/start-swank.lisp"'
" slimv for ccl
let g:slimv_swank_cmd = '! tmux new-window -d -n REPL-CCL "ccl -l ~/.vim/bundle/slimv/slime/start-swank.lisp"'

let g:rbpt_colorpairs = [ 
    \ ['brown',       'RoyalBlue3'],
    \ ['Darkblue',    'SeaGreen3'],
    \ ['darkgray',    'DarkOrchid3'],
    \ ['darkgreen',   'firebrick3'],
    \ ['darkcyan',    'RoyalBlue3'],
    \ ['darkred',     'SeaGreen3'],
    \ ['darkmagenta', 'DarkOrchid3'],
    \ ['brown',       'firebrick3'],
    \ ['gray',        'RoyalBlue3'],
    \ ['black',       'SeaGreen3'],
    \ ['darkmagenta', 'DarkOrchid3'],
    \ ['Darkblue',    'firebrick3'],
    \ ['darkgreen',   'RoyalBlue3'],
    \ ['darkcyan',    'SeaGreen3'],
    \ ['darkred',     'DarkOrchid3'],
    \ ['red',         'firebrick3'],
    \ ]

nmap r0 :RainbowParenthesesToggle<CR>   " uesd                                                                                                                                    
nmap r1 :RainbowParenthesesLoadRound<CR>
nmap r2 :RainbowParenthesesLoadSquare<CR>
nmap r3 :RainbowParenthesesLoadBraces<CR>
nmap r4 :RainbowParenthesesLoadChevrons<CR>

set nocompatible
filetype off
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()

Plugin 'VundleVim/Vundle.vim'
Plugin 'racer-rust/vim-racer'
Plugin 'rust-lang/rust.vim'

call vundle#end()

filetype on
" and run :PluginInstall

" snippets
" Track the engine.
Plugin 'SirVer/ultisnips'

" Snippets are separated from the engine. Add this if you want them:
Plugin 'honza/vim-snippets'

" Trigger configuration. Do not use <tab> if you use https://github.com/Valloric/YouCompleteMe.
let g:UltiSnipsExpandTrigger="<tab>"
let g:UltiSnipsJumpForwardTrigger="<c-b>"
let g:UltiSnipsJumpBackwardTrigger="<c-z>"
 
" If you want :UltiSnipsEdit to split your window.
let g:UltiSnipsEditSplit="vertical"

